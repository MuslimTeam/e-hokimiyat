FOYDALANUVCHILARNI QOâ€˜SHISH VA BIRIKTIRISH MODELI

(PNFL / JSHSHR + OneID asosida)

1. ASOSIY KONSEPSIYA (MUHIM)

ğŸ‘‰ Foydalanuvchi tizimga oldindan kiritiladi
ğŸ‘‰ OneID orqali birinchi kirganda profili avtomatik faollashadi
ğŸ‘‰ Kim kimni qoâ€˜sha olishi qatâ€™iy ierarxiya bilan belgilanadi

Bu model:

xavfsiz

nazoratli

â€œbegona odam kirib ketishiâ€ni imkonsiz qiladi

2. IERARXIYA VA KIM KIMNI QOâ€˜SHA OLADI

âœ… TUMAN HOKIMI qoâ€˜sha oladi:

Hokimlik masÊ¼uli

Tashkilot rahbari

Tashkilot masÊ¼uli

âœ… HOKIMLIK MASÊ¼ULI qoâ€˜sha oladi:

Tashkilot rahbari

Tashkilot masÊ¼uli

âœ… TASHKILOT RAHBARI qoâ€˜sha oladi:

Tashkilot masÊ¼uli

âŒ Tashkilot masÊ¼uli:

hech kimni qoâ€˜sha olmaydi

3. FOYDALANUVCHI QOâ€˜SHISH JARAYONI (TEXNIK OQIM)

1-bosqich. PNFL (JSHSHR) orqali qoâ€˜shish

Vakolatli shaxs quyidagi maâ€™lumotlarni kiritadi:

PNFL (JSHSHR) â€” majburiy

F.I.Sh

Rol (faqat oâ€˜ziga ruxsat etilgan rollar)

Tashkilot (agar mavjud boâ€˜lsa)

Lavozim

Telefon (ixtiyoriy)

ğŸ“Œ Bu vaqtda foydalanuvchi holati:

status = "KUTILMOQDA"

oneid_connected = false

2-bosqich. OneID orqali kirish

Foydalanuvchi:

OneID login/paroli bilan tizimga kiradi

OneIDâ€™dan kelgan JSHSHR tizimdagi JSHSHR bilan match qilinadi

Agar mos kelsa:

status = "FAOL"

oneid_connected = true

first_login_at = timestamp

âŒ Agar JSHSHR mos kelmasa â€” kirish rad etiladi.

4. TEXNIK QOIDALAR (JUDAYAM MUHIM)

ğŸ” Xavfsizlik:

OneIDâ€™dan kelgan JSHSHR â€” asosiy identifikator

Foydalanuvchi JSHSHR ni oâ€˜zi oâ€˜zgartira olmaydi

Bitta JSHSHR = bitta aktiv profil

ğŸ§¾ Audit log:

Har bir amal yoziladi:

kim qoâ€˜shdi

qaysi rol bilan

qachon

qaysi tashkilotga

Misol:

2026-01-17 10:32

Hokim (ID:1)

Tashkilot rahbari qoâ€˜shdi

PNFL: ***********

5. ROL VA KABINETLARGA BIRIKTIRISH (UI LOGIKA)

Kabinet rolga qarab avtomatik ochiladi.

6. CHEGARALAR VA BLOKIROVKALAR

Hokim:

oâ€˜zini oâ€˜chira olmaydi

Hokimlik masÊ¼uli:

hokimni oâ€˜chira olmaydi

hokim huquqlarini pasaytira olmaydi

Tashkilot rahbari:

boshqa tashkilotga foydalanuvchi qoâ€˜sha olmaydi

7. NIMA UCHUN BU MODEL TOâ€˜Gâ€˜RI?

PNFL = real shaxs

OneID = davlat tasdiqlagan autentifikatsiya

Oldindan qoâ€˜shish = nazorat

Ierarxiya = tartib

Audit log = masÊ¼uliyat

Bu model my.gov.uz, e-ijro, e-xatlov kabi tizimlarda qoâ€˜llanadigan klassik va ishonchli yondashuv.

8. QISQA TEXNIK FORMULA

User (PNFL) -> Pre-created

â†“

OneID login

â†“

PNFL match

â†“

Profile activated

â†“

Role-based cabinet

YAKUNIY XULOSA

ğŸ‘‰ Siz aytgan talab 100% toâ€˜gâ€˜ri va professional
ğŸ‘‰ Bu yondashuv bilan tizim:

xavfsiz boâ€˜ladi

boshqariladigan boâ€˜ladi

davlat auditi talablariga mos boâ€˜ladi

9. FOYDALANUVCHI HAYOT SIKLI (USER LIFECYCLE)

9.1. Holatlar (statuslar)

DRAFT        â€“ tizimga PNFL kiritilgan, lekin hali faollashmagan

KUTILMOQDA   â€“ OneID orqali kirishi kutilmoqda

FAOL         â€“ OneID orqali muvaffaqiyatli kirgan

BLOKLANGAN  â€“ vaqtincha oâ€˜chirilgan

ARXIV       â€“ lavozimdan ketgan (tarix saqlanadi)

9.2. Hayot sikli oqimi

[PNFL kiritildi]

â†“

[DRAFT / KUTILMOQDA]

â†“  (OneID login)

[FAOL]

â†“

[BLOKLANGAN] â†’ qayta FAOL boâ€˜lishi mumkin

â†“

[ARXIV] (qayta faollashtirib boâ€˜lmaydi)

â— Topshiriqlar va loglar ARXIV foydalanuvchida ham saqlanadi

10. MAâ€™LUMOTLAR BAZASI MODELI (SODDALASHTIRILGAN)

10.1. User (foydalanuvchi)

User

- id

- pnfl (unique, indexed)

- first_name

- last_name

- middle_name

- phone

- role_id

- organization_id (nullable)

- status

- oneid_connected (bool)

- created_by (FK User)

- created_at

- activated_at

10.2. Role

Role

- id

- name

(Hokim, Hokimlik masÊ¼uli, Tashkilot rahbari, Tashkilot masÊ¼uli, Admin)

10.3. Organization

Organization

- id

- name

- parent_org (nullable)

- is_active

10.4. UserAssignment (kim kimni qoâ€˜shgan)

UserAssignment

- id

- assigned_user

- assigned_by

- assigned_role

- assigned_at

Bu jadval audit va ierarxiyani tekshirish uchun juda muhim.

11. ROLE â†’ PERMISSION MATRIX (ANIQ)

12. FOYDALANUVCHI QOâ€˜SHISH API OQIMI

12.1. User create (PNFL orqali)

POST /api/users/

{

"pnfl": "12345678901234",

"role": "ORG_MANAGER",

"organization_id": 5

}

Server tekshiradi:

rol ruxsat etilganmi

tashkilot mos keladimi

ierarxiya buzilmaganmi

12.2. OneID login callback

OneID â†’ redirect â†’ /auth/oneid/callback

Backend:

OneIDâ€™dan pnfl oladi

bazadagi pnfl bilan solishtiradi

mos boâ€˜lsa â†’ FAOL qiladi

13. ONEID INTEGRATSIYA SXEMASI

User â†’ Login via OneID

â†“

OneID Auth Server

â†“

Callback (pnfl, fio)

â†“

Local DB check

â†“

Profile activation

âŒ PNFL topilmasa:

â€œSiz tizimga oldindan kiritilmagansizâ€

14. XAVFSIZLIK CHEGARALARI

OneID maâ€™lumotlari:

faqat backendda saqlanadi

Frontend PNFL koâ€˜rmaydi (masking)

Har bir:

qoâ€˜shish

oâ€˜chirish

rol oâ€˜zgarishi
alohida audit logga yoziladi

15. NIMA UCHUN BU ARXITEKTURA MUVAFFAQIYATLI?

Ierarxiya buzilmaydi

Hokim toâ€˜liq nazoratda

MasÊ¼uliyat shaxsga bogâ€˜langan

OneID bilan davlat darajasida tasdiq

Audit tekshiruvdan oâ€˜tadi

16. TOPSHIRIQ HAYOT SIKLI (TASK LIFECYCLE)

17.1. Topshiriq statuslari (yakuniy, standartlashtirilgan)

YANGI

IJRODA

BAJARILDI

QAYTA_IJROGA_YUBORILDI

MUDDATI_KECH

BAJARILMADI

NAZORATDAN_YECHILDI

â— Muhim:
â€œNAZORATDAN_YECHILDIâ€ â€” yakuniy status
undan keyin hech qanday oâ€˜zgarish boâ€˜lmaydi.

16.2. Status oâ€˜zgarishlariga KIM RUXSAT BERADI

16.3. Avtomatik statuslar (SYSTEM ACTION)

Quyidagi statuslar foydalanuvchi tomonidan emas, tizim tomonidan oâ€˜zgartiriladi:

IJRODA â†’ MUDDATI_KECH

MUDDATI_KECH â†’ BAJARILMADI

ğŸ“Œ Bu Celery background job orqali ishlaydi (har 5â€“10 daqiqa).

17. TOPSHIRIQ IJROSI (IJRO JURNALI)

17.1. TaskExecution modeli

TaskExecution

- id

- task_id

- executed_by (User)

- action_type

- comment

- attachments

- created_at

action_type qiymatlari:

IJROGA_OLINDI

HISOBOT_TOPSHIRILDI

QAYTA_YUBORILDI

NAZORATDAN_YECHILDI

MUDDAT_UZAYTIRISH_SOROVI

Bu jadval:

sud

prokuratura

audit
uchun asosiy dalil boâ€˜ladi.

18. CHAT + IJRO = BITTA TIMELINE

â— Muhim dizayn qarori:
Chat alohida emas, topshiriq tarixining bir qismi boâ€˜ladi.

TaskTimeline

- message

- file

- audio

- system_log

Natija:

â€œNima boâ€˜ldi?â€ degan savolga bitta sahifada javob

19. MUDDAT UZAYTIRISH MEXANIZMI

19.1. Kim soâ€˜rov yubora oladi

Tashkilot rahbari

Tashkilot masÊ¼uli

19.2. Kim tasdiqlaydi

Faqat Hokim

19.3. Status oqimi

IJRODA

â†“ (soâ€˜rov)

MUDDAT_UZAYTIRISH_KUTILMOQDA

â†“ (hokim)

IJRODA (yangi deadline)

20. BIR NECHTA TASHKILOTGA BIRIKTIRILGAN TOPSHIRIQ

Muhim qoida:

Topshiriq bitta,

lekin ijro sub-tasklar boâ€˜ladi.

Task

â”œâ”€â”€ TaskOrganization (Org A) â†’ status

â”œâ”€â”€ TaskOrganization (Org B) â†’ status

â””â”€â”€ TaskOrganization (Org C) â†’ status

ğŸ”¹ Hokim:

har bir tashkilot ijrosini alohida koâ€˜radi

umumiy statusni faqat oâ€˜zi yopadi

21. ANALITIKA UCHUN MUHIM METRIKALAR

Tizim avtomatik hisoblaydi:

oâ€˜rtacha ijro muddati

kechikish foizi

tashkilot reytingi

ustuvorlik boâ€˜yicha yuklama

masÊ¼ul xodimlar samaradorligi

Bu AI modulga toâ€˜gâ€˜ridan-toâ€˜gâ€˜ri ozuqa boâ€˜ladi.

22. REAL HAYOTDAGI SCENARIY (MISOL)

Hokim topshiriq yaratdi (3 ta tashkilot)

Tashkilot A â†’ ijroga oldi

Tashkilot B â†’ kechikdi

Tashkilot C â†’ bajarib hisobot yukladi

Hokim:

C ni nazoratdan yechdi

B ni qayta ijroga yubordi

ğŸ‘‰ Hammasi bitta topshiriq ichida, aniq va shaffof.

23. API ENDPOINTLAR (IMPLEMENTATSIYAGA TAYYOR)

23.1. AUTENTIFIKATSIYA (OneID)

GET  /auth/oneid/login

GET  /auth/oneid/callback

POST /auth/logout

GET  /auth/me

/auth/me
â€“ foydalanuvchi roli
â€“ kabinet turi
â€“ tashkilot
â€“ huquqlar (permissions)

23.2. FOYDALANUVCHILAR (PNFL ASOSIDA)

Foydalanuvchi qoâ€˜shish

POST /api/users/

{

"pnfl": "12345678901234",

"role": "ORG_MANAGER",

"organization_id": 7,

"position": "Boâ€˜lim boshligâ€˜i"

}

â¡ï¸ Backend tekshiradi:

kim qoâ€˜shyapti

qaysi rolni qoâ€˜sha oladi

ierarxiya buzilmaganmi

Foydalanuvchilar roâ€˜yxati

GET /api/users/?role=ORG_MANAGER&status=FAOL

Foydalanuvchini bloklash / arxivlash

PATCH /api/users/{id}/block

PATCH /api/users/{id}/archive

23.3. TASHKILOTLAR

POST   /api/organizations/

GET    /api/organizations/

PUT    /api/organizations/{id}

DELETE /api/organizations/{id}

âš ï¸ Faqat:

Hokim

Hokimlik masÊ¼uli

23.4. TOPSHIRIQLAR

Topshiriq yaratish

POST /api/tasks/

{

"title": "Ichki yoâ€˜llarni taâ€™mirlash",

"description": "...",

"priority": "MUHIM_SHOSHILINCH",

"deadline": "2026-02-01",

"organizations": [3,5,7],

"location": {

"lat": 40.123,

"lng": 67.456

}

}

Topshiriqlar roâ€˜yxati

GET /api/tasks/?status=IJRODA&priority=MUHIM

Filtrlar:

status

muddat

tashkilot

ustuvorlik

kechikkan / kechikmagan

23.5. TOPSHIRIQ IJROSI

Ijroga olish

POST /api/tasks/{id}/accept

Hisobot topshirish

POST /api/tasks/{id}/report

{

"comment": "Bajarildi",

"attachments": ["file1.pdf", "photo.jpg"]

}

Muddat uzaytirish soâ€˜rovi

POST /api/tasks/{id}/extend-request

23.6. HOKIM AMALLARI (FAKAT HOKIM)

POST /api/tasks/{id}/close

POST /api/tasks/{id}/reassign

POST /api/tasks/{id}/remove-control

23.7. CHAT / TIMELINE

GET  /api/tasks/{id}/timeline

POST /api/tasks/{id}/message

{

"type": "text | file | audio",

"content": "Izoh..."

}

23.8. ANALITIKA

GET /api/analytics/dashboard

GET /api/analytics/organizations

GET /api/analytics/users

24. BACKEND TEXNIK QOIDALAR

Har bir endpoint:

permission check

audit log yozadi

PNFL frontendga toâ€˜liq koâ€˜rinmaydi (masking)

Fayllar alohida storageâ€™da

Status oâ€˜zgarishi â†’ signal â†’ notification

25. FRONTEND UCHUN TAYYOR HOLAT

Shu API bilan:

frontend mustaqil ishlay oladi

mobil ilova keyin qoâ€˜shilishi mumkin

boshqa davlat tizimlari integratsiyasi oson

Rol

Kabinet

Hokim

Hokim kabineti

Hokimlik masÊ¼uli

Hokimlik kabineti

Tashkilot rahbari

Tashkilot kabineti

Tashkilot masÊ¼uli

Tashkilot kabineti

Admin

Texnik admin

Amal

Hokim

Hokimlik masÊ¼uli

Tashkilot rahbari

Tashkilot masÊ¼uli

Hokimlik masÊ¼ulini qoâ€˜shish

âœ…

âœ…

âŒ

âŒ

Tashkilot rahbarini qoâ€˜shish

âœ…

âœ…

âŒ

âŒ

Tashkilot masÊ¼ulini qoâ€˜shish

âœ…

âœ…

âœ…

âŒ

Tashkilot yaratish

âœ…

âœ…

âŒ

âŒ

Topshiriq yaratish

âœ…

âœ…

âŒ

âŒ

Nazoratdan yechish

âœ…

âŒ

âŒ

âŒ

Hisobot yuklash

âŒ

âŒ

âœ…

âœ…

Status oâ€˜zgarishi

Hokim

Hokimlik masÊ¼uli

Tashkilot rahbari

Tashkilot masÊ¼uli

YANGI â†’ IJRODA

âŒ (avto)

âŒ

âœ…

âœ…

IJRODA â†’ BAJARILDI

âŒ

âŒ

âœ…

âœ…

BAJARILDI â†’ NAZORATDAN_YECHILDI

âœ…

âŒ

âŒ

âŒ

BAJARILDI â†’ QAYTA_IJROGA_YUBORILDI

âœ…

âŒ

âŒ

âŒ

IJRODA â†’ MUDDATI_KECH

âŒ (avto)

âŒ

âŒ

âŒ

MUDDATI_KECH â†’ BAJARILDI

âŒ

âŒ

âœ…

âœ…

MUDDATI_KECH â†’ BAJARILMADI

âŒ (avto)

âŒ

âŒ

âŒ