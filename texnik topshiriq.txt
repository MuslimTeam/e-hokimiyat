________________________________________
FOYDALANUVCHILARNI QOâ€˜SHISH VA BIRIKTIRISH MODELI
(PNFL / JSHSHR + OneID asosida)
1. ASOSIY KONSEPSIYA (MUHIM)
ğŸ‘‰ Foydalanuvchi tizimga oldindan kiritiladi
ğŸ‘‰ OneID orqali birinchi kirganda profili avtomatik faollashadi
ğŸ‘‰ Kim kimni qoâ€˜sha olishi qatâ€™iy ierarxiya bilan belgilanadi
Bu model:
â—	xavfsiz
â—	nazoratli
â—	â€œbegona odam kirib ketishiâ€ni imkonsiz qiladi
________________________________________
2. IERARXIYA VA KIM KIMNI QOâ€˜SHA OLADI
âœ… TUMAN HOKIMI qoâ€˜sha oladi:
â—	Hokimlik masÊ¼uli
â—	Tashkilot rahbari
â—	Tashkilot masÊ¼uli
âœ… HOKIMLIK MASÊ¼ULI qoâ€˜sha oladi:
â—	Tashkilot rahbari
â—	Tashkilot masÊ¼uli
âœ… TASHKILOT RAHBARI qoâ€˜sha oladi:
â—	Tashkilot masÊ¼uli
âŒ Tashkilot masÊ¼uli:
â—	hech kimni qoâ€˜sha olmaydi
________________________________________
3. FOYDALANUVCHI QOâ€˜SHISH JARAYONI (TEXNIK OQIM)
1-bosqich. PNFL (JSHSHR) orqali qoâ€˜shish
Vakolatli shaxs quyidagi maâ€™lumotlarni kiritadi:
â—	PNFL (JSHSHR) â€” majburiy
â—	F.I.Sh
â—	Rol (faqat oâ€˜ziga ruxsat etilgan rollar)
â—	Tashkilot (agar mavjud boâ€˜lsa)
â—	Lavozim
â—	Telefon (ixtiyoriy)
ğŸ“Œ Bu vaqtda foydalanuvchi holati:
status = "KUTILMOQDA"
oneid_connected = false

________________________________________
2-bosqich. OneID orqali kirish
Foydalanuvchi:
â—	OneID login/paroli bilan tizimga kiradi
â—	OneIDâ€™dan kelgan JSHSHR tizimdagi JSHSHR bilan match qilinadi
Agar mos kelsa:
status = "FAOL"
oneid_connected = true
first_login_at = timestamp

âŒ Agar JSHSHR mos kelmasa â€” kirish rad etiladi.
________________________________________
4. TEXNIK QOIDALAR (JUDAYAM MUHIM)
ğŸ” Xavfsizlik:
â—	OneIDâ€™dan kelgan JSHSHR â€” asosiy identifikator
â—	Foydalanuvchi JSHSHR ni oâ€˜zi oâ€˜zgartira olmaydi
â—	Bitta JSHSHR = bitta aktiv profil
________________________________________
ğŸ§¾ Audit log:
Har bir amal yoziladi:
â—	kim qoâ€˜shdi
â—	qaysi rol bilan
â—	qachon
â—	qaysi tashkilotga
Misol:
2026-01-17 10:32
Hokim (ID:1)
Tashkilot rahbari qoâ€˜shdi
PNFL: ***********

________________________________________
5. ROL VA KABINETLARGA BIRIKTIRISH (UI LOGIKA)
Rol	Kabinet
Hokim	Hokim kabineti
Hokimlik masÊ¼uli	Hokimlik kabineti
Tashkilot rahbari	Tashkilot kabineti
Tashkilot masÊ¼uli	Tashkilot kabineti
Admin	Texnik admin
Kabinet rolga qarab avtomatik ochiladi.
________________________________________
6. CHEGARALAR VA BLOKIROVKALAR
â—	Hokim:
â—‹	oâ€˜zini oâ€˜chira olmaydi
â—	Hokimlik masÊ¼uli:
â—‹	hokimni oâ€˜chira olmaydi
â—‹	hokim huquqlarini pasaytira olmaydi
â—	Tashkilot rahbari:
â—‹	boshqa tashkilotga foydalanuvchi qoâ€˜sha olmaydi
________________________________________
7. NIMA UCHUN BU MODEL TOâ€˜Gâ€˜RI?
1.	PNFL = real shaxs
2.	OneID = davlat tasdiqlagan autentifikatsiya
3.	Oldindan qoâ€˜shish = nazorat
4.	Ierarxiya = tartib
5.	Audit log = masÊ¼uliyat
Bu model my.gov.uz, e-ijro, e-xatlov kabi tizimlarda qoâ€˜llanadigan klassik va ishonchli yondashuv.
________________________________________
8. QISQA TEXNIK FORMULA
User (PNFL) -> Pre-created
â†“
OneID login
â†“
PNFL match
â†“
Profile activated
â†“
Role-based cabinet

________________________________________
YAKUNIY XULOSA
ğŸ‘‰ Siz aytgan talab 100% toâ€˜gâ€˜ri va professional
ğŸ‘‰ Bu yondashuv bilan tizim:
â—	xavfsiz boâ€˜ladi
â—	boshqariladigan boâ€˜ladi
â—	davlat auditi talablariga mos boâ€˜ladi
________________________________________
9. FOYDALANUVCHI HAYOT SIKLI (USER LIFECYCLE)
9.1. Holatlar (statuslar)
DRAFT        â€“ tizimga PNFL kiritilgan, lekin hali faollashmagan
KUTILMOQDA   â€“ OneID orqali kirishi kutilmoqda
FAOL         â€“ OneID orqali muvaffaqiyatli kirgan
BLOKLANGAN  â€“ vaqtincha oâ€˜chirilgan
ARXIV       â€“ lavozimdan ketgan (tarix saqlanadi)

________________________________________
9.2. Hayot sikli oqimi
[PNFL kiritildi]
        â†“
[DRAFT / KUTILMOQDA]
        â†“  (OneID login)
[FAOL]
        â†“
[BLOKLANGAN] â†’ qayta FAOL boâ€˜lishi mumkin
        â†“
[ARXIV] (qayta faollashtirib boâ€˜lmaydi)

â— Topshiriqlar va loglar ARXIV foydalanuvchida ham saqlanadi
________________________________________
10. MAâ€™LUMOTLAR BAZASI MODELI (SODDALASHTIRILGAN)
10.1. User (foydalanuvchi)
User
- id
- pnfl (unique, indexed)
- first_name
- last_name
- middle_name
- phone
- role_id
- organization_id (nullable)
- status
- oneid_connected (bool)
- created_by (FK User)
- created_at
- activated_at

________________________________________
10.2. Role
Role
- id
- name
(Hokim, Hokimlik masÊ¼uli, Tashkilot rahbari, Tashkilot masÊ¼uli, Admin)

________________________________________
10.3. Organization
Organization
- id
- name
- parent_org (nullable)
- is_active

________________________________________
10.4. UserAssignment (kim kimni qoâ€˜shgan)
UserAssignment
- id
- assigned_user
- assigned_by
- assigned_role
- assigned_at

Bu jadval audit va ierarxiyani tekshirish uchun juda muhim.
________________________________________
11. ROLE â†’ PERMISSION MATRIX (ANIQ)
Amal	Hokim	Hokimlik masÊ¼uli	Tashkilot rahbari	Tashkilot masÊ¼uli
Hokimlik masÊ¼ulini qoâ€˜shish	âœ…	âœ…	âŒ	âŒ
Tashkilot rahbarini qoâ€˜shish	âœ…	âœ…	âŒ	âŒ
Tashkilot masÊ¼ulini qoâ€˜shish	âœ…	âœ…	âœ…	âŒ
Tashkilot yaratish	âœ…	âœ…	âŒ	âŒ
Topshiriq yaratish	âœ…	âœ…	âŒ	âŒ
Nazoratdan yechish	âœ…	âŒ	âŒ	âŒ
Hisobot yuklash	âŒ	âŒ	âœ…	âœ…
________________________________________
12. FOYDALANUVCHI QOâ€˜SHISH API OQIMI
12.1. User create (PNFL orqali)
POST /api/users/

{
  "pnfl": "12345678901234",
  "role": "ORG_MANAGER",
  "organization_id": 5
}

Server tekshiradi:
â—	rol ruxsat etilganmi
â—	tashkilot mos keladimi
â—	ierarxiya buzilmaganmi
________________________________________
12.2. OneID login callback
OneID â†’ redirect â†’ /auth/oneid/callback

Backend:
â—	OneIDâ€™dan pnfl oladi
â—	bazadagi pnfl bilan solishtiradi
â—	mos boâ€˜lsa â†’ FAOL qiladi
________________________________________
13. ONEID INTEGRATSIYA SXEMASI
User â†’ Login via OneID
        â†“
OneID Auth Server
        â†“
Callback (pnfl, fio)
        â†“
Local DB check
        â†“
Profile activation

âŒ PNFL topilmasa:
â€œSiz tizimga oldindan kiritilmagansizâ€
________________________________________
14. XAVFSIZLIK CHEGARALARI
â—	OneID maâ€™lumotlari:
â—‹	faqat backendda saqlanadi
â—	Frontend PNFL koâ€˜rmaydi (masking)
â—	Har bir:
â—‹	qoâ€˜shish
â—‹	oâ€˜chirish
â—‹	rol oâ€˜zgarishi
alohida audit logga yoziladi
________________________________________
15. NIMA UCHUN BU ARXITEKTURA MUVAFFAQIYATLI?
1.	Ierarxiya buzilmaydi
2.	Hokim toâ€˜liq nazoratda
3.	MasÊ¼uliyat shaxsga bogâ€˜langan
4.	OneID bilan davlat darajasida tasdiq
5.	Audit tekshiruvdan oâ€˜tadi
________________________________________
16. TOPSHIRIQ HAYOT SIKLI (TASK LIFECYCLE)
17.1. Topshiriq statuslari (yakuniy, standartlashtirilgan)
YANGI
IJRODA
BAJARILDI
QAYTA_IJROGA_YUBORILDI
MUDDATI_KECH
BAJARILMADI
NAZORATDAN_YECHILDI

â— Muhim:
â€œNAZORATDAN_YECHILDIâ€ â€” yakuniy status
undan keyin hech qanday oâ€˜zgarish boâ€˜lmaydi.
________________________________________
16.2. Status oâ€˜zgarishlariga KIM RUXSAT BERADI
Status oâ€˜zgarishi	Hokim	Hokimlik masÊ¼uli	Tashkilot rahbari	Tashkilot masÊ¼uli
YANGI â†’ IJRODA	âŒ (avto)	âŒ	âœ…	âœ…
IJRODA â†’ BAJARILDI	âŒ	âŒ	âœ…	âœ…
BAJARILDI â†’ NAZORATDAN_YECHILDI	âœ…	âŒ	âŒ	âŒ
BAJARILDI â†’ QAYTA_IJROGA_YUBORILDI	âœ…	âŒ	âŒ	âŒ
IJRODA â†’ MUDDATI_KECH	âŒ (avto)	âŒ	âŒ	âŒ
MUDDATI_KECH â†’ BAJARILDI	âŒ	âŒ	âœ…	âœ…
MUDDATI_KECH â†’ BAJARILMADI	âŒ (avto)	âŒ	âŒ	âŒ
________________________________________
16.3. Avtomatik statuslar (SYSTEM ACTION)
Quyidagi statuslar foydalanuvchi tomonidan emas, tizim tomonidan oâ€˜zgartiriladi:
â—	IJRODA â†’ MUDDATI_KECH
â—	MUDDATI_KECH â†’ BAJARILMADI
ğŸ“Œ Bu Celery background job orqali ishlaydi (har 5â€“10 daqiqa).
________________________________________
17. TOPSHIRIQ IJROSI (IJRO JURNALI)
17.1. TaskExecution modeli
TaskExecution
- id
- task_id
- executed_by (User)
- action_type
- comment
- attachments
- created_at

action_type qiymatlari:
IJROGA_OLINDI
HISOBOT_TOPSHIRILDI
QAYTA_YUBORILDI
NAZORATDAN_YECHILDI
MUDDAT_UZAYTIRISH_SOROVI

Bu jadval:
â—	sud
â—	prokuratura
â—	audit
uchun asosiy dalil boâ€˜ladi.
________________________________________
18. CHAT + IJRO = BITTA TIMELINE
â— Muhim dizayn qarori:
Chat alohida emas, topshiriq tarixining bir qismi boâ€˜ladi.
TaskTimeline
- message
- file
- audio
- system_log

Natija:
â—	â€œNima boâ€˜ldi?â€ degan savolga bitta sahifada javob
________________________________________
19. MUDDAT UZAYTIRISH MEXANIZMI
19.1. Kim soâ€˜rov yubora oladi
â—	Tashkilot rahbari
â—	Tashkilot masÊ¼uli
19.2. Kim tasdiqlaydi
â—	Faqat Hokim
19.3. Status oqimi
IJRODA
  â†“ (soâ€˜rov)
MUDDAT_UZAYTIRISH_KUTILMOQDA
  â†“ (hokim)
IJRODA (yangi deadline)

________________________________________
20. BIR NECHTA TASHKILOTGA BIRIKTIRILGAN TOPSHIRIQ
Muhim qoida:
â—	Topshiriq bitta,
â—	lekin ijro sub-tasklar boâ€˜ladi.
Task
 â”œâ”€â”€ TaskOrganization (Org A) â†’ status
 â”œâ”€â”€ TaskOrganization (Org B) â†’ status
 â””â”€â”€ TaskOrganization (Org C) â†’ status

ğŸ”¹ Hokim:
â—	har bir tashkilot ijrosini alohida koâ€˜radi
â—	umumiy statusni faqat oâ€˜zi yopadi
________________________________________
21. ANALITIKA UCHUN MUHIM METRIKALAR
Tizim avtomatik hisoblaydi:
â—	oâ€˜rtacha ijro muddati
â—	kechikish foizi
â—	tashkilot reytingi
â—	ustuvorlik boâ€˜yicha yuklama
â—	masÊ¼ul xodimlar samaradorligi
Bu AI modulga toâ€˜gâ€˜ridan-toâ€˜gâ€˜ri ozuqa boâ€˜ladi.
________________________________________
22. REAL HAYOTDAGI SCENARIY (MISOL)
1.	Hokim topshiriq yaratdi (3 ta tashkilot)
2.	Tashkilot A â†’ ijroga oldi
3.	Tashkilot B â†’ kechikdi
4.	Tashkilot C â†’ bajarib hisobot yukladi
5.	Hokim:
â—‹	C ni nazoratdan yechdi
â—‹	B ni qayta ijroga yubordi
ğŸ‘‰ Hammasi bitta topshiriq ichida, aniq va shaffof.
________________________________________
23. API ENDPOINTLAR (IMPLEMENTATSIYAGA TAYYOR)
23.1. AUTENTIFIKATSIYA (OneID)
GET  /auth/oneid/login
GET  /auth/oneid/callback
POST /auth/logout
GET  /auth/me

/auth/me
â€“ foydalanuvchi roli
â€“ kabinet turi
â€“ tashkilot
â€“ huquqlar (permissions)
________________________________________
23.2. FOYDALANUVCHILAR (PNFL ASOSIDA)
Foydalanuvchi qoâ€˜shish
POST /api/users/

{
  "pnfl": "12345678901234",
  "role": "ORG_MANAGER",
  "organization_id": 7,
  "position": "Boâ€˜lim boshligâ€˜i"
}

â¡ï¸ Backend tekshiradi:
â—	kim qoâ€˜shyapti
â—	qaysi rolni qoâ€˜sha oladi
â—	ierarxiya buzilmaganmi
________________________________________
Foydalanuvchilar roâ€˜yxati
GET /api/users/?role=ORG_MANAGER&status=FAOL

________________________________________
Foydalanuvchini bloklash / arxivlash
PATCH /api/users/{id}/block
PATCH /api/users/{id}/archive

________________________________________
23.3. TASHKILOTLAR
POST   /api/organizations/
GET    /api/organizations/
PUT    /api/organizations/{id}
DELETE /api/organizations/{id}

âš ï¸ Faqat:
â—	Hokim
â—	Hokimlik masÊ¼uli
________________________________________
23.4. TOPSHIRIQLAR
Topshiriq yaratish
POST /api/tasks/

{
  "title": "Ichki yoâ€˜llarni taâ€™mirlash",
  "description": "...",
  "priority": "MUHIM_SHOSHILINCH",
  "deadline": "2026-02-01",
  "organizations": [3,5,7],
  "location": {
    "lat": 40.123,
    "lng": 67.456
  }
}

________________________________________
Topshiriqlar roâ€˜yxati
GET /api/tasks/?status=IJRODA&priority=MUHIM

Filtrlar:
â—	status
â—	muddat
â—	tashkilot
â—	ustuvorlik
â—	kechikkan / kechikmagan
________________________________________
23.5. TOPSHIRIQ IJROSI
Ijroga olish
POST /api/tasks/{id}/accept

Hisobot topshirish
POST /api/tasks/{id}/report

{
  "comment": "Bajarildi",
  "attachments": ["file1.pdf", "photo.jpg"]
}

________________________________________
Muddat uzaytirish soâ€˜rovi
POST /api/tasks/{id}/extend-request

________________________________________
23.6. HOKIM AMALLARI (FAKAT HOKIM)
POST /api/tasks/{id}/close
POST /api/tasks/{id}/reassign
POST /api/tasks/{id}/remove-control

________________________________________
23.7. CHAT / TIMELINE
GET  /api/tasks/{id}/timeline
POST /api/tasks/{id}/message

{
  "type": "text | file | audio",
  "content": "Izoh..."
}

________________________________________
23.8. ANALITIKA
GET /api/analytics/dashboard
GET /api/analytics/organizations
GET /api/analytics/users

________________________________________
24. BACKEND TEXNIK QOIDALAR
â—	Har bir endpoint:
â—‹	permission check
â—‹	audit log yozadi
â—	PNFL frontendga toâ€˜liq koâ€˜rinmaydi (masking)
â—	Fayllar alohida storageâ€™da
â—	Status oâ€˜zgarishi â†’ signal â†’ notification
________________________________________
25. FRONTEND UCHUN TAYYOR HOLAT
Shu API bilan:
â—	frontend mustaqil ishlay oladi
â—	mobil ilova keyin qoâ€˜shilishi mumkin
â—	boshqa davlat tizimlari integratsiyasi oson
________________________________________

